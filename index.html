

    }

    //监听播放器的timeupdate事件，实现文字与音频播放同步
    audio.ontimeupdate = function () {
        if(lineNo==oLRC.ms.length)
            return;
        var curTime = audio.currentTime; //播放器时间
        if(parseFloat(oLRC.ms[lineNo].t)<=curTime){
            lineHigh();//高亮当前行
            lineNo++;
        }
    };

    //监听播放器的ended事件，播放结束时回滚歌词
    /*audio.onended = function () {
        goback();
    };*/

    function getLRC(lrcName) {

        lrc = "";
        var ajax = new XMLHttpRequest();
        ajax.open("get", "lrc/"+lrcName +".lrc",true);
        ajax.send(null);
        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {

                lrc = ajax.responseText;
                createLrcObj(lrc);
                //console.log(lrc);
            }
        };

    }

    function createLrcObj(lrc) {

        if(lrc.length==0) return;
        var lrcs = lrc.split('\n');//用回车拆分成数组

        for(var i in lrcs) {//遍历歌词数组
            lrcs[i] = lrcs[i].replace(/(^\s*)|(\s*$)/g, ""); //去除前后空格
            var t = lrcs[i].substring(lrcs[i].indexOf("[") + 1, lrcs[i].indexOf("]"));//取[]间的内容
            var s = t.split(":");//分离:前后文字
            if(isNaN(parseInt(s[0]))) { //不是数值
                for (var i in oLRC) {
                    if (i != "ms" && i == s[0].toLowerCase()) {
                        oLRC[i] = s[1];
                    }
                }
            }else { //是数值
                var arr = lrcs[i].match(/\[(\d+:.+?)\]/g);//提取时间字段，可能有多个
                var start = 0;
                for(var k in arr){
                    start += arr[k].length; //计算歌词位置
                }
                var content = lrcs[i].substring(start);//获取歌词内容

                for (var k in arr){
                    var t = arr[k].substring(1, arr[k].length-1);//取[]间的内容
                    var s = t.split(":");//分离:前后文字
                    oLRC.ms.push({//对象{t:时间,c:歌词}加入ms数组
                        t: (parseFloat(s[0])*60+parseFloat(s[1])).toFixed(3),
                        c: content
                    });
                }
            }
        }

        oLRC.ms.sort(function (a, b) {//按时间顺序排序
            return a.t-b.t;
        });
        showLRC();
    }

    function showLRC() {
        var s="";
        for(var i in oLRC.ms){//遍历ms数组，把歌词加入列表
            s+='<li>'+oLRC.ms[i].c+'</li>';
        }
        document.getElementById("lyric").innerHTML = s;

    }



    // 播放
    play.onclick = function(){
        if(audio.paused){
            audio.play();
            document.getElementById("musicImg").classList.remove("stop");
            document.getElementById("musicImg").classList.add("running");
        }

    }

    function hasClass(element,className){
        var aSameClassEle  = document.getElementsByClassName(className);
        for (var i = 0;i < aSameClassEle .length;i++){
            if(aSameClassEle[i] === element){
                return true;
            }
        }
    }

    // 暂停
    pause.onclick = function(){
        if(audio.played){
            audio.pause();
            document.getElementById("musicImg").classList.remove("running");
            document.getElementById("musicImg").classList.add("stop");
        }
    }

    // 上一首
    prev.onclick = function(){
        num = (num + len - 1) % len;
        audio.src = './music/' + music[num] + '.mp3';
        lrcName1 = lrcName[num];
        lineNo = 0;
        oLRC.ms = [];
        getLRC(lrcName1);
        musicName.innerHTML = music[num];
        bgImage.style.backgroundImage = 'url(./image/' + music[num] + '.jpg)';
        musicImg.src = './image/' + music[num] + '.jpg';
        play.onclick();
    }

    // 下一首
    next.onclick = function(){
        num = (num + 1) % len;
        audio.src = './music/' + music[num] + '.mp3';
        lrcName1 = lrcName[num];
        lineNo = 0;
        oLRC.ms = [];
        getLRC(lrcName1);
        musicName.innerHTML = music[num];
        bgImage.style.backgroundImage = 'url(./image/' + music[num] + '.jpg)';
        musicImg.src = './image/' + music[num] + '.jpg';
        play.onclick();
    }

    // 自动切换下一首
    audio.addEventListener('ended',function(){
        goback();
        next.onclick();
    },false);
</script>
</body>
</html>
